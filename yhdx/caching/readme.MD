### 缓存策略



策略1

1、更新：淘汰缓存；步骤是：删除缓存 --> 更新数据库 --> 增加一个延时删除缓存的操作（删除缓存后，到更新数据库，若有MySQL主从同步，数据库的数据主库同步到从库，在整个这一段时间窗口内，若有其它线程从MySQL从库加载数据到缓存，此数据可能不是更新后的数据，所以增加一次延迟删除缓存的操作）。

2、访问：缓存存在则返回；否则从数据库加载（分布式锁保护，防止同时并行多次加载），数据库若存在，更新缓存，然后返回；若数据库不存在，则设置缓存一个空值（例如&&），防止缓存击穿，然后返回null。

3、任务：定时执行延时删除缓存队列中的任务请求。



策略2

1、更新：标记缓存；步骤是：标记缓存数据过时 --> 更新数据库 --> 发起异步淘汰缓存请求（可配置淘汰的延时时间）。

2、访问：缓存不存在，则从数据库加载（分布式锁保护，防止同时并行多次加载），数据库若存在，更新缓存，然后返回；若数据库不存在，则设置缓存一个空值（例如&&），防止缓存击穿，然后返回null；若缓存存在，但是标记为过时，且过时时间超过了最大忍耐时间阈值，则删除缓存，从数据库加载（分布式锁保护，防止同时并行多次加载）；否则直接返回缓存的值。

3、任务：定时执行删除缓存队列中的任务请求。

